<HTML>
<HEAD>
	<SCRIPT type="text/javascript" src="./jquery/js/jquery-1.4.4.min.js"></SCRIPT>
	<SCRIPT type="text/javascript" src="./jquery/js/jquery-ui-1.8.7.custom.min.js"></SCRIPT>
	
		<SCRIPT type="text/javascript" src="./getPath.js"></SCRIPT>
	<SCRIPT type="text/javascript" src="./rangy-core.js"></SCRIPT>
	<SCRIPT type="text/javascript" src="./selectionsaverestore.js"></SCRIPT>
	<SCRIPT type="text/javascript" src="./textSelection.js"></SCRIPT>
	<SCRIPT type="text/javascript" src="./contextHelp.js"></SCRIPT>
	<SCRIPT type="text/javascript" src="./underscore-min.js"></SCRIPT>
	<style type="text/css">
		.tag{
			color: blue;
		}
	</style>
	<SCRIPT type="text/javascript">
		tagMode=false;
		$(document).ready(function(){
			
				ts = new TextSelector();
   	$("body").keypress(function(e){
			$("#quack").html(e.charCode);
					if (!(tagMode)) {
						switch (e.charCode) {
						
							case 60:
								// <					
								possibleTags = contextHelp.text.elements;
								contextHelp.text.elements
								document.execCommand("insertHTML", false, "<span class='tag'>&lt;</span>");
								tagMode = true;
								e.preventDefault();
								break;
							case 62:
								// <
								mypos = rangy.getSelection();
								newPos = rangy.createRange();
								fon = mypos.focusNode.parentNode;
								newText = $(fon).html() + "&gt;";
								$(fon).html(newText);
								newPos.selectNode(fon);
								mypos = rangy.getSelection();
								mypos.setSingleRange(newPos);
								mypos.collapseToEnd();
								e.preventDefault();
								break;
						}
					}
					else {
						if (e.charCode == 62)
						{
								mypos = rangy.getSelection();
								newPos = rangy.createRange();
								fon = mypos.focusNode.parentNode;
								newText = $(fon).html() + "&gt;";
								$(fon).html(newText);
								newPos.selectNode(fon);
								mypos = rangy.getSelection();
								mypos.setSingleRange(newPos);
								mypos.collapseToEnd();
								tagMode = false;
								e.preventDefault();
														
						}
						else if ((((e.charCode > 64) && (e.charCode < 90)) || ((e.charCode > 96) && (e.charCode < 122)))||(e.charCode==58)) {
							
						}
						else{
							e.preventDefault();
						}
					}
                    
                });	
		
			
			$("#cool").mousedown(function(e){joy = ts.getSelectedText();alert(JSON.stringify(joy));});
		
		});
		function showMessage(data){
		
			$("#Messages").html(data);
			
		}
	</SCRIPT>
<title>TEI Editor</title>
	</HEAD>
	<BODY>
		<div id="cool">cool</div>
		<div id="quack"></div>
		<table>
		<tr>
			<td>
		<div id="texted" contenteditable="true" width=500 height=500>
			Test text
		</div>
		</td>
		<td>
		<div id="Messages">
			
		</div>
		<div id="tree">
			
		</div></td>
		</tr>
		</table>
		
		
	</BODY>
	
	</HTML>